suite: test helpers template via deployment
templates:
  - deployment.yaml
tests:
  - it: should generate correct resource names using helpers
    template: deployment.yaml
    release:
      name: test-release
    asserts:
      - equal:
          path: metadata.name
          value: test-release-package-tracker

  - it: should generate correct labels using helpers
    template: deployment.yaml
    chart:
      name: package-tracker
      version: 0.1.0
      appVersion: 1.0.0
    release:
      name: test-release
    asserts:
      - equal:
          path: metadata.labels["helm.sh/chart"]
          value: package-tracker-0.1.0
      - equal:
          path: metadata.labels["app.kubernetes.io/name"]
          value: package-tracker
      - equal:
          path: metadata.labels["app.kubernetes.io/instance"]
          value: test-release
      - equal:
          path: metadata.labels["app.kubernetes.io/version"]
          value: "1.0.0"
      - equal:
          path: metadata.labels["app.kubernetes.io/managed-by"]
          value: Helm

  - it: should generate correct selector labels using helpers
    template: deployment.yaml
    release:
      name: test-release
    asserts:
      - equal:
          path: spec.selector.matchLabels["app.kubernetes.io/name"]
          value: package-tracker
      - equal:
          path: spec.selector.matchLabels["app.kubernetes.io/instance"]
          value: test-release

  - it: should support name override
    template: deployment.yaml
    set:
      nameOverride: custom-name
    release:
      name: test-release
    asserts:
      - equal:
          path: metadata.name
          value: test-release-custom-name

  - it: should support fullname override
    template: deployment.yaml
    set:
      fullnameOverride: custom-fullname
    release:
      name: test-release
    asserts:
      - equal:
          path: metadata.name
          value: custom-fullname